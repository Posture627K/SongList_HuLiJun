<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>æ­Œæ›²ç®¡ç†é¢æ¿</title>
</head>
<body>
<h1>ğŸ§ æ­Œæ›²ç®¡ç†é¢æ¿</h1>

<!-- æ·»åŠ æ­Œæ›²è¡¨å• -->
<h2>æ·»åŠ æ­Œæ›²</h2>
<form id="addForm">
    <input type="text" id="title" placeholder="æ­Œå" required>
    <input type="text" id="artist" placeholder="æ­Œæ‰‹">
    <input type="text" id="genre" placeholder="é£æ ¼" required>
    <button type="submit">æ·»åŠ æ­Œæ›²</button>
</form>

<hr>

<!-- åˆ é™¤æ­Œæ›²åŒºåŸŸ -->
<h2>å·²æ·»åŠ æ­Œæ›²</h2>
<button onclick="loadSongs()">åˆ·æ–°</button>
<ul id="songList"></ul>

<script>
    // æ·»åŠ æ­Œæ›²
    document.getElementById("addForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        const song = {
            title: document.getElementById("title").value,
            artist: document.getElementById("artist").value,
            genre: document.getElementById("genre").value
        };

        try {
            await fetch("http://localhost:8080/api/songs/add", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(song)
            });
            alert("âœ… æ­Œæ›²æ·»åŠ æˆåŠŸï¼");
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById("addForm").reset();
            loadSongs();
        } catch (error) {
            alert("âŒ æ·»åŠ å¤±è´¥ï¼š" + error);
        }
    });

    // åŠ è½½æ­Œæ›²å¹¶æ˜¾ç¤ºâ€œåˆ é™¤â€æŒ‰é’®
    async function loadSongs() {
        try {
            const res = await fetch("http://localhost:8080/api/songs/search?keyword=");
            const songs = await res.json();
            const list = document.getElementById("songList");
            list.innerHTML = "";

            if (songs.length === 0) {
                list.innerHTML = "<li>æš‚æ— æ­Œæ›²ã€‚</li>";
                return;
            }

            songs.forEach(song => {
                const li = document.createElement("li");
                li.textContent = `${song.title} - ${song.artist} [${song.genre ?? "æ— é£æ ¼"}]`;

                const btn = document.createElement("button");
                btn.textContent = "åˆ é™¤";
                btn.style.marginLeft = "10px";
                btn.onclick = async () => {
                    if (confirm(`ç¡®å®šè¦åˆ é™¤ã€Š${song.title}ã€‹å—ï¼Ÿ`)) {
                        await fetch(`http://localhost:8080/api/songs/delete?id=${song.id}`, {
                            method: "DELETE"
                        });
                        loadSongs(); // åˆ·æ–°
                    }
                };

                li.appendChild(btn);
                list.appendChild(li);
            });
        } catch (error) {
            alert("âŒ åŠ è½½æ­Œæ›²å¤±è´¥ï¼š" + error);
        }
    }

    // é¡µé¢åŠ è½½å®Œæˆæ—¶è‡ªåŠ¨åŠ è½½
    window.onload = loadSongs;
</script>
</body>
</html>
